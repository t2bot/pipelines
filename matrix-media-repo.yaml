steps:
  - label: "🤝 Complement"
    env:
      COMPLEMENT_BASE_IMAGE: complement-dendrite
      COMPLEMENT_VERSION_CHECK_ITERATIONS: 400
    commands: 
      - "echo '--- install go 1.14'"
      - "curl -L https://golang.org/dl/go1.14.6.linux-amd64.tar.gz > go.tar.gz"
      - "tar -C . -xzf go.tar.gz"
      - "sudo yum groupinstall 'Development Tools'"
      - "echo '+++ run tests'"
      - "chmod +x ci-complement.sh" # To fix the script
      - "PATH=$PATH:$(pwd)/go/bin ./ci-complement.sh"
steps__:
  - label: "🔨 Build :go: 1.14"
    commands: 
      - "echo '+++ build'"
      - "./build.sh"
    plugins:
      - docker#v3.0.1:
          image: "golang:1.14"
          mount-buildkite-agent: false
  - label: "🤝 Complement"
    env:
      COMPLEMENT_BASE_IMAGE: complement-media-repo
      COMPLEMENT_VERSION_CHECK_ITERATIONS: 400
    commands: 
      - "echo '--- install go 1.14'"
      - "curl -L https://golang.org/dl/go1.14.6.linux-amd64.tar.gz > go.tar.gz"
      - "tar -C . -xzf go.tar.gz"
      - "echo '--- make docker image'"
      - "docker build -t complement-media-repo -f Complement.Dockerfile ."
      - "echo '+++ run tests'"
      - "chmod +x ci-complement.sh" # To fix the script
      - "PATH=$PATH:$(pwd)/go/bin ./ci-complement.sh"
